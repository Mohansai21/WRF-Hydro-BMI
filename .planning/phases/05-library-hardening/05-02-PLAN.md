---
phase: 05-library-hardening
plan: 02
type: execute
wave: 2
depends_on:
  - "05-01"
files_modified:
  - CLAUDE.md
  - bmi_wrf_hydro/Docs/16_Shared_Library_Python_Babelizer_Complete_Guide.md
autonomous: true
requirements:
  - LIB-01
  - LIB-02
  - LIB-03

must_haves:
  truths:
    - "CLAUDE.md no longer references bmi_wrf_hydro_c.f90 as a key file or active component"
    - "CLAUDE.md reflects that C binding layer was removed for babelizer compatibility"
    - "Doc 16 no longer describes C binding symbols as available in the shared library"
  artifacts:
    - path: "CLAUDE.md"
      provides: "Updated project instructions reflecting C binding removal"
      contains: "C binding layer removed"
    - path: "bmi_wrf_hydro/Docs/16_Shared_Library_Python_Babelizer_Complete_Guide.md"
      provides: "Updated documentation reflecting library hardening changes"
  key_links:
    - from: "CLAUDE.md"
      to: "bmi_wrf_hydro/src/"
      via: "Key Files section listing only bmi_wrf_hydro.f90 + hydro_stop_shim.f90"
      pattern: "src/bmi_wrf_hydro\\.f90.*hydro_stop_shim"
---

<objective>
Update CLAUDE.md and Doc 16 to reflect the removal of the C binding layer, ensuring future sessions have accurate context.

Purpose: Per user decision, documentation must be updated in this phase (not deferred to Phase 9). CLAUDE.md is the primary context file that Claude reads at the start of every session — stale references to deleted files would cause confusion and wasted effort.

Output: Updated CLAUDE.md and Doc 16 with all C binding references removed or marked as historical.
</objective>

<execution_context>
@/home/mohansai/.claude/get-shit-done/workflows/execute-plan.md
@/home/mohansai/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-library-hardening/05-CONTEXT.md
@.planning/phases/05-library-hardening/05-01-SUMMARY.md
@CLAUDE.md
@bmi_wrf_hydro/Docs/16_Shared_Library_Python_Babelizer_Complete_Guide.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update CLAUDE.md to reflect C binding removal</name>
  <files>CLAUDE.md</files>
  <action>
    Read CLAUDE.md and update ALL sections that reference the C binding layer. Specific sections to update:

    **1. Key Files to Know section:**
    - REMOVE the line: `bmi_wrf_hydro/src/bmi_wrf_hydro_c.f90 -> C BINDING LAYER (ISO_C_BINDING interface for shared library)`
    - Add a note after hydro_stop_shim.f90: `# NOTE: bmi_wrf_hydro_c.f90 was removed in Phase 5 (C bindings conflict with babelizer's auto-generated interop layer)`

    **2. Directory Structure section:**
    - Update `bmi_wrf_hydro/src/` description to list only `bmi_wrf_hydro.f90 + hydro_stop_shim.f90` (remove mention of `bmi_wrf_hydro_c.f90`)

    **3. Phase 1.5 status section:**
    - Update to note C binding layer was removed in Phase 5
    - Keep the historical checkmarks but add context that C bindings are no longer in the library
    - Remove `bmi_wrf_hydro_c.f90` from the completed items or mark as "removed in Phase 5"

    **4. Current Status section:**
    - Change "C BINDING LAYER COMPLETE" to "C BINDING LAYER REMOVED (Phase 5 — babelizer generates its own)"
    - Remove references to `bmi_wrf_hydro_c.f90` as an active file

    **5. Shared Library Details section:**
    - Remove `bmi_wrf_hydro_c_mod.mod` from the installed modules list
    - Remove C symbols from the exported list (bmi_initialize, bmi_update, etc.)
    - Note that the library now exports only Fortran module symbols (__bmiwrfhydrof_MOD_*)
    - Update build command to note --shared auto-installs to $CONDA_PREFIX

    **6. 5-Layer Architecture section:**
    - No changes needed (it describes the babelizer pathway, not C bindings)

    **7. Build Environment section:**
    - No changes needed (toolchain unchanged)

    Do NOT change any sections unrelated to C bindings. Preserve all formatting and structure.
  </action>
  <verify>
    <automated>cd /mnt/c/Users/mohansai/Desktop/Projects/VS_Code/WRF-Hydro-BMI && grep -c "bmi_wrf_hydro_c.f90" CLAUDE.md | xargs -I{} test {} -le 2 && echo "PASS: C binding references minimized (at most historical note)" || echo "FAIL: Too many active C binding references remain"</automated>
    <manual>Read Key Files section — should NOT list bmi_wrf_hydro_c.f90 as an active file. Shared Library Details should NOT list C symbols.</manual>
  </verify>
  <done>
    - CLAUDE.md Key Files section no longer lists bmi_wrf_hydro_c.f90 as active
    - Phase 1.5 section notes C binding removal
    - Current Status reflects "C BINDING LAYER REMOVED"
    - Shared Library Details lists only Fortran module symbols
    - No stale references that would mislead future Claude sessions
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Doc 16 to reflect C binding removal</name>
  <files>bmi_wrf_hydro/Docs/16_Shared_Library_Python_Babelizer_Complete_Guide.md</files>
  <action>
    Read Doc 16 and update references to the C binding layer. The research identified ~16 occurrences.

    **Strategy:** The C binding layer was a valid Phase 3 deliverable that has been superseded by the babelizer pathway. Update Doc 16 to reflect this by:

    1. **Sections describing C binding as current/active:** Add a note that C bindings were removed in Phase 5 for babelizer compatibility. The babelizer auto-generates its own interop layer (bmi_interoperability.f90).

    2. **Code examples showing C binding usage:** Mark as historical or remove. If the section is primarily about C bindings (e.g., a dedicated C binding section), add a "Historical Note" header explaining the change.

    3. **Architecture diagrams showing C binding flow:** Update to show the babelizer pathway instead, or mark the C binding path as "removed".

    4. **Babelizer readiness checklist:** Update to reflect that C symbol check is now "no conflicting C symbols" rather than "C symbols exported".

    5. **File listings that include bmi_wrf_hydro_c.f90:** Remove from active listings. Can remain in historical context.

    Follow the project's doc style: emojis/icons, detailed explanations, ML analogies where helpful.

    Do NOT rewrite the entire document. Make surgical updates to affected sections only.
  </action>
  <verify>
    <automated>cd /mnt/c/Users/mohansai/Desktop/Projects/VS_Code/WRF-Hydro-BMI && grep -c "bmi_wrf_hydro_c" bmi_wrf_hydro/Docs/16_Shared_Library_Python_Babelizer_Complete_Guide.md</automated>
    <manual>Remaining references should be historical/past-tense only, not describing C bindings as active components.</manual>
  </verify>
  <done>
    - Doc 16 no longer describes C binding layer as an active component
    - Historical references are clearly marked as superseded
    - Babelizer readiness section updated to reflect Phase 5 changes
    - File listings updated to exclude deleted files
  </done>
</task>

</tasks>

<verification>
1. `grep -c "bmi_wrf_hydro_c.f90" CLAUDE.md` returns a low count (only historical notes, not active references)
2. CLAUDE.md Key Files section lists only bmi_wrf_hydro.f90 and hydro_stop_shim.f90 in src/
3. CLAUDE.md Shared Library Details does not list C symbols (bmi_initialize, bmi_update, etc.)
4. Doc 16 does not describe C binding layer as currently available
</verification>

<success_criteria>
- CLAUDE.md accurately reflects the post-Phase-5 state of the project
- Doc 16 accurately reflects the shared library's current symbol exports
- No documentation describes deleted files as active components
- Future Claude sessions will not attempt to use bmi_wrf_hydro_c.f90
</success_criteria>

<output>
After completion, create `.planning/phases/05-library-hardening/05-02-SUMMARY.md`
</output>
