---
phase: 09-pymt-integration
task: 0
total_tasks: 0
status: planning
last_updated: 2026-02-25T21:18:00.737Z
---

<current_state>
Phase 9 planning is IN PROGRESS. Research is COMPLETE (09-RESEARCH.md written and expanded to ~568 lines by GSD hooks), but the plan file(s) (09-01-PLAN.md etc.) have NOT been written yet. All 3 research agents finished (2 hit rate limits after gathering sufficient data, 1 completed normally). Next step is writing the plan files.
</current_state>

<completed_work>

- 09-CONTEXT.md: Already existed (gathered in prior session with user decisions)
- 09-RESEARCH.md: COMPLETE (~568 lines) covering:
  - PyMT plugin discovery mechanism (entry_points, importlib.metadata)
  - ModelMetadata discovery (search_paths, METADATA attribute, from_obj)
  - Required metadata YAML files (info.yaml, parameters.yaml, run.yaml, config template)
  - Reference examples from pymt_ecsimplesnow and pymt_child
  - PyMT installation strategy (dry-run + fallback) and dependency risk analysis
  - Current pymt_wrfhydro state analysis (full directory structure)
  - File sync strategy (meta/ vs data/ directories)
  - Jupyter notebook architecture (10 sections from CONTEXT.md)
  - Standard stack, architecture patterns, anti-patterns, 7 common pitfalls
  - Code examples (4 complete examples)
  - Open questions (4 items)
- Research agents (all 3 completed):
  1. pymt_wrfhydro explore agent — COMPLETE (full directory structure, all files mapped)
  2. PyMT metadata format agent — COMPLETE (info.yaml/parameters.yaml/run.yaml formats, METADATA attribute, search_paths source code, pymt_ecsimplesnow + pymt_child examples)
  3. PyMT install compatibility agent — COMPLETE (PyMT deps info, entry_points mechanism)
</completed_work>

<remaining_work>

- Write 09-01-PLAN.md: Install PyMT + create metadata YAML files + validate `from pymt.models import WrfHydroBmi` (covers PYMT-01, PYMT-02, PYMT-03)
- Write 09-02-PLAN.md: Comprehensive Jupyter notebook (all 41 BMI functions, visualizations, ~20-line vision demo)
- Write 09-03-PLAN.md: Doc 19 capstone document (PYMT-04) — full Fortran-to-Python journey
- Update ROADMAP.md with plan count (Plans: 0/3 -> plan entries)
- Execute all 3 plans
- Write 09-VERIFICATION.md after execution
- Update STATE.md
</remaining_work>

<decisions_made>

- Phase 9 splits into 3 plans: (1) PyMT + metadata + registry, (2) Jupyter notebook, (3) Doc 19
- Metadata files go to BOTH pymt_wrfhydro/data/WrfHydroBmi/ (packaged) AND meta/WrfHydroBmi/ (convention)
- WrfHydroBmi class needs METADATA attribute added to pymt_wrfhydro/bmi.py
- Config template uses Jinja2 `{{ wrfhydro_run_dir }}` syntax (following pymt_ecsimplesnow pattern)
- PyMT install: try `conda install --dry-run` first, then actual install; pip as fallback
- Doc number is 19 (Doc 18 already taken by BMI Compliance Validation from Phase 8)
- model_metadata package is a PyMT dependency that reads the YAML files
- info.yaml follows pymt_ecsimplesnow format (name, summary, url, author, email, version, license, doi, cite_as)
- parameters.yaml keeps minimal (wrfhydro_run_dir only) — WRF-Hydro config is complex, full params deferred to v2
- api.yaml needs initialize_args field added
</decisions_made>

<blockers>

- Rate limit hit during planning — need to resume in next session
- PyMT + OpenMPI 5.0.8 ABI compatibility unknown — must test with --dry-run (flagged in STATE.md)
</blockers>

<context>
We were executing the /gsd:plan-phase 9 workflow. The GSD skill wasn't found via the Skill tool (plugin issue), so we did the research manually by:
1. Reading ROADMAP.md, STATE.md, REQUIREMENTS.md, 09-CONTEXT.md
2. Launching 3 parallel research agents (PyMT metadata format, pymt_wrfhydro state, PyMT install compat)
3. Reading existing files (meta/WrfHydroBmi/api.yaml, setup.py, MANIFEST.in, reference 08-01-PLAN.md)
4. Synthesizing into 09-RESEARCH.md (then expanded by GSD hooks to full format)

The plan format should follow 08-01-PLAN.md style (Pre-conditions, Tasks with What/Files/Commands/Verify, Completion Criteria, Risk Mitigation).

Key insights from research:
- PyMT uses model_metadata package which needs METADATA attribute on the BMI class pointing to data/WrfHydroBmi/ directory
- The babelizer-generated code does NOT add METADATA attribute automatically — we must add it
- pymt_ecsimplesnow is the best reference for our metadata files (simpler than pymt_child)
- pymt_child uses data/ as a symlink to ../meta/ — our package has real directories in both places
- model_metadata.ModelMetadata.search_paths() checks hasattr(model, "METADATA") first
- PyMT install highest risk is scipy (compiled, may constrain numpy)
- Notebook MUST be launched under MPI: mpirun --oversubscribe -np 1 jupyter notebook
</context>

<next_action>
Resume by writing the 3 plan files:
1. Read 09-RESEARCH.md to restore context
2. Write 09-01-PLAN.md (PyMT install + metadata + registry validation)
3. Write 09-02-PLAN.md (Jupyter notebook)
4. Write 09-03-PLAN.md (Doc 19)
5. Update ROADMAP.md with Plans: 0/3 -> plan entries
6. Then execute plans in order
</next_action>
