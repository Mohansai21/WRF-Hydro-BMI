---
phase: 07-package-build
task: 0
total_tasks: 0
status: planned_not_started
last_updated: 2026-02-25T16:59:11.369Z
---

<current_state>
Phase 6 (Babelizer Environment + Skeleton) just completed and verified (4/4 must-haves). Phase 7 (Package Build) is next but has NO plans yet — needs discuss-phase then plan-phase before execution.

The phase 7 directory exists (.planning/phases/07-package-build/) but contains only this handoff file. No CONTEXT.md, RESEARCH.md, or PLAN.md yet.
</current_state>

<completed_work>

- Phase 5 (Library Hardening): COMPLETE — C binding layer removed, .so rebuilt, 151 tests pass
- Phase 6 (Babelizer Env + Skeleton): COMPLETE — babelizer 0.3.9 installed, babel.toml written, pymt_wrfhydro/ skeleton generated
  - babel.toml at project root with naming chain: library=bmiwrfhydrof, entry_point=bmi_wrf_hydro, package=pymt_wrfhydro
  - pymt_wrfhydro/ skeleton: bmi_interoperability.f90 (810 lines), wrfhydrobmi.pyx (526 lines), setup.py, pyproject.toml
  - Naming chain verified correct in all generated files
  - Verification passed 4/4 must-haves
</completed_work>

<remaining_work>

- /gsd:discuss-phase 7 — Capture user's design preferences for package build (NOT STARTED)
- /gsd:plan-phase 7 — Create PLAN.md for package build (NOT STARTED)
- /gsd:execute-phase 7 — Build + install pymt_wrfhydro (NOT STARTED)
- Phase 8: Validate with bmi-tester (future)
- Phase 9: PyMT Integration (future)
</remaining_work>

<decisions_made>

- Babelizer 0.3.9 generates setuptools-based packages (setup.py, not meson.build) — acceptable
- pip --no-build-isolation MANDATORY for all pip install commands
- Package location: pymt_wrfhydro/ at project root
- Runtime deps: mpi4py + netCDF4
- License: "MIT License" (cookiecutter constraint)
- Phases 7-9 exist in roadmap but are not yet planned (TBD placeholders)
</decisions_made>

<blockers>

- [Phase 7 known issue]: Dry-run build during Phase 6 revealed `undefined symbol: hydro_stop_` when importing pymt_wrfhydro — libbmiwrfhydrof.so needs hydro_stop_ symbol resolved (documented in 06-01-SUMMARY.md)
- [Phase 7 success criteria]: pip install --no-build-isolation must work, import must work, init/update/finalize must run against Croton NY
</blockers>

<context>
Phase 7 goal from roadmap: "pymt_wrfhydro is built, installed, and importable from Python, with the full initialize/update/finalize cycle working end-to-end against Croton NY data"

Requirements: BUILD-01, BUILD-02, BUILD-03, BUILD-04

Success criteria:
1. `pip install --no-build-isolation .` completes inside pymt_wrfhydro/
2. `from pymt_wrfhydro import WrfHydroBmi` imports without error
3. MPI loaded correctly before Cython extension imports libbmiwrfhydrof.so (no segfault)
4. Python script calling initialize()/update()/finalize() with Croton NY runs to completion

The hydro_stop_ symbol issue is the primary technical challenge — hydro_stop_shim.f90 defines hydro_stop but setup.py may not be linking it correctly, or the symbol mangling differs between what bmi_interoperability.f90 expects and what the .so exports.

v2.0 milestone progress: 3/9 plans complete (phases 5-6 done, phases 7-9 ahead).
</context>

<next_action>
Start with: `/gsd:discuss-phase 7` — capture user design preferences for how to approach the package build, especially around the hydro_stop_ linking issue, setup.py modifications, and MPI initialization strategy. Then `/gsd:plan-phase 7` to create the execution plan.
</next_action>
