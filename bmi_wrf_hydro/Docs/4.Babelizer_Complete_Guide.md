# ğŸ”® The Babelizer â€” Complete Guide

> **The Automatic Translator: Fortran/C/C++ BMI â†’ Python Package**
> *Turn Any BMI-Compliant Model Into a pip-installable Python Library*

---

## ğŸ“š Official Sources Used

| Source | URL |
|--------|-----|
| Babelizer GitHub | https://github.com/csdms/babelizer |
| Babelizer ReadTheDocs | https://babelizer.readthedocs.io |
| CSDMS Wiki: Babelizer | https://csdms.colorado.edu/wiki/Babelizer |
| BMI Docs: Babelizer & PyMT | https://bmi.csdms.io/en/latest/csdms.html |
| CSDMS Workbench | https://csdms.colorado.edu/wiki/Workbench |
| Fortran BMI Spec | https://github.com/csdms/bmi-fortran |
| Fortran BMI Example | https://github.com/csdms/bmi-example-fortran |
| Anaconda Package | https://anaconda.org/conda-forge/babelizer |

---

## 1ï¸âƒ£ What Is the Babelizer?

### ğŸ¯ The One-Line Definition

From the official CSDMS docs:

> *"The Babelizer is an open source Python utility for wrapping models that expose a BMI so they can be imported as Python packages."*

### ğŸŒ‰ The Bridge Analogy

Think of the Babelizer as an **automatic bridge builder**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   YOUR MODEL                    BABELIZER                  PYTHON WORLD  â”‚
â”‚   (Fortran/C/C++)              (The Bridge)               (pip install!) â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ bmi_wrf_    â”‚     â”‚  Reads babel.toml   â”‚     â”‚  pymt_wrfhydro  â”‚   â”‚
â”‚   â”‚ hydro.f90   â”‚â”€â”€â”€â”€â†’â”‚  Generates Cython   â”‚â”€â”€â”€â”€â†’â”‚  Python package â”‚   â”‚
â”‚   â”‚ (Fortran    â”‚     â”‚  Creates setup.py   â”‚     â”‚  Ready for pip  â”‚   â”‚
â”‚   â”‚  BMI code)  â”‚     â”‚  Builds bindings    â”‚     â”‚  or conda!      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚   You write THIS          Babelizer does THIS        You get THIS        â”‚
â”‚   (the hard part)         (AUTOMATICALLY!)            (the reward)       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”‘ What Happens After Babelizing?

Once babelized, your model â€” **regardless of its original language** â€” appears as a Python class with BMI methods:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  In Python, your Fortran model becomes:          â”‚
â”‚                                                  â”‚
â”‚  from pymt_wrfhydro import WrfHydro              â”‚
â”‚                                                  â”‚
â”‚  model = WrfHydro()                              â”‚
â”‚  model.initialize("config.yaml")                 â”‚
â”‚  model.update()                                  â”‚
â”‚  data = model.get_value("discharge")             â”‚
â”‚  model.finalize()                                â”‚
â”‚                                                  â”‚
â”‚  â†‘ This calls Fortran code underneath!           â”‚
â”‚    But you never see it. Pure Python interface.   â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ“Œ **ML Analogy:** The Babelizer is like **pybind11** or **SWIG** â€” tools that auto-generate Python bindings for C++/Fortran libraries. You write your model in a fast language, then access it from Python.

---

## 2ï¸âƒ£ The Three Prerequisites

### âœ… Requirements Before You Can Babelize

From the official Babelizer README on GitHub:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚  PREREQUISITE 1: Language                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚  Your model must be written in:                                      â”‚
â”‚  â€¢ C                                                                 â”‚
â”‚  â€¢ C++                                                               â”‚
â”‚  â€¢ Fortran                                                           â”‚
â”‚  â€¢ Python                                                            â”‚
â”‚                                                                      â”‚
â”‚  PREREQUISITE 2: Shared Library                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚  Your model must be compilable as a shared library (.so / .dylib)    â”‚
â”‚  This means it must be buildable with:                               â”‚
â”‚  â€¢ cmake (recommended)                                               â”‚
â”‚  â€¢ make                                                              â”‚
â”‚  â€¢ or another build system                                           â”‚
â”‚                                                                      â”‚
â”‚  PREREQUISITE 3: BMI Implementation â† THE HARD PART                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  Your model must implement all 41 BMI functions.                     â”‚
â”‚  This is the most work â€” but also the most valuable!                 â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

For our project:
- âœ… **Language:** WRF-Hydro is Fortran â†’ supported
- âš ï¸ **Shared Library:** WRF-Hydro currently builds as an executable, not a library. Must reconfigure cmake to produce `libwrfhydro_bmi.so`
- âŒ **BMI:** WRF-Hydro has NO BMI yet â†’ Step 1 of our project is to write one (`bmi_wrf_hydro.f90`)

---

## 3ï¸âƒ£ The Babelizer Workflow: Step by Step

### ğŸ—ºï¸ The Complete Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                        â”‚
â”‚  STEP 1          STEP 2           STEP 3           STEP 4             â”‚
â”‚  Write BMI       Create           Run              Install             â”‚
â”‚  Wrapper         babel.toml       Babelizer        Package             â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Write   â”‚    â”‚ Describe â”‚    â”‚ $ babelize   â”‚  â”‚ $ pip installâ”‚   â”‚
â”‚  â”‚ bmi_wrf_â”‚â”€â”€â”€â†’â”‚ your lib â”‚â”€â”€â”€â†’â”‚   init       â”‚â”€â†’â”‚   .          â”‚   â”‚
â”‚  â”‚ hydro   â”‚    â”‚ in TOML  â”‚    â”‚   babel.toml â”‚  â”‚              â”‚   â”‚
â”‚  â”‚ .f90    â”‚    â”‚ format   â”‚    â”‚              â”‚  â”‚ Creates:     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Generates:   â”‚  â”‚ pymt_wrfhydroâ”‚   â”‚
â”‚                                 â”‚ â€¢ _cython/   â”‚  â”‚ ready to use!â”‚   â”‚
â”‚  41 BMI funcs    Language,      â”‚ â€¢ setup.py   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  wrapping        library name,  â”‚ â€¢ pyproject  â”‚                      â”‚
â”‚  WRF-Hydro       entry point    â”‚ â€¢ README     â”‚  Now do:             â”‚
â”‚  internals       etc.           â”‚ â€¢ CI config  â”‚  from pymt_wrfhydro  â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  import WrfHydro     â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4ï¸âƒ£ The babel.toml File: Anatomy

### ğŸ“„ The Heart of the Babelizer

The `babel.toml` file is a configuration file (TOML format) that tells the Babelizer everything it needs to know about your library. Let's dissect it section by section.

### ğŸ“‹ Example: HydroTrend (official CSDMS example from GitHub)

```toml
[library]
[library.Hydrotrend]
language = "c"
library = "bmi_hydrotrend"
header = "bmi_hydrotrend.h"
entry_point = "register_bmi_hydrotrend"

[build]
undef_macros = []
define_macros = []
libraries = []
library_dirs = []
include_dirs = []
extra_compile_args = []

[package]
name = "pymt_hydrotrend"
requirements = ["hydrotrend"]

[info]
github_username = "pymt-lab"
package_author = "csdms"
package_author_email = "csdms@colorado.edu"
package_license = "MIT"
summary = "PyMT plugin for hydrotrend"

[ci]
python_version = ["3.9"]
os = ["linux", "mac", "windows"]
```

### ğŸ” Section-by-Section Breakdown

#### ğŸ“¦ [library] Section â€” Your Model's Identity

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [library.ClassName]                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚                                                                      â”‚
â”‚  ClassName        The Python class name for your model.              â”‚
â”‚                   Must be CamelCase (Python convention).             â”‚
â”‚                   Examples: "WrfHydro", "Schism", "Hydrotrend"       â”‚
â”‚                                                                      â”‚
â”‚  language         "c", "c++", "fortran", or "python"                â”‚
â”‚                   For WRF-Hydro: "fortran"                           â”‚
â”‚                                                                      â”‚
â”‚  library          The shared library name (without lib prefix        â”‚
â”‚                   or .so/.dylib suffix).                             â”‚
â”‚                   This is passed to the linker as -l<name>           â”‚
â”‚                   Example: "bmi_wrf_hydro" â†’ links libwrfhydro.so   â”‚
â”‚                                                                      â”‚
â”‚  header           (C/C++ only) The .h file declaring the BMI class  â”‚
â”‚                   Not needed for Fortran!                            â”‚
â”‚                                                                      â”‚
â”‚  entry_point      The BMI entry point in the library.                â”‚
â”‚                   For Fortran: the name of the BMI MODULE            â”‚
â”‚                   For C: the register function name                  â”‚
â”‚                   Example: "bmi_wrf_hydro_module"                    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ”§ [build] Section â€” Compilation Settings

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [build]                                                             â”‚
â”‚                                                                      â”‚
â”‚  define_macros      CPP preprocessor flags                          â”‚
â”‚                     e.g. ["USE_NWM_BMI"]                            â”‚
â”‚                                                                      â”‚
â”‚  libraries          Additional libraries to link against             â”‚
â”‚                     e.g. ["netcdf", "netcdff", "hdf5"]              â”‚
â”‚                                                                      â”‚
â”‚  library_dirs       Paths to search for libraries                    â”‚
â”‚                     e.g. ["/opt/netcdf/lib"]                         â”‚
â”‚                                                                      â”‚
â”‚  include_dirs       Paths to search for header/module files          â”‚
â”‚                     e.g. ["/opt/netcdf/include"]                     â”‚
â”‚                                                                      â”‚
â”‚  extra_compile_args Extra flags passed to the compiler               â”‚
â”‚                     e.g. ["-O2", "-fopenmp"]                         â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ“› [package] Section â€” The Output Python Package

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [package]                                                           â”‚
â”‚                                                                      â”‚
â”‚  name              The Python package name                           â”‚
â”‚                    Convention: "pymt_<modelname>"                     â”‚
â”‚                    Examples: "pymt_wrfhydro", "pymt_schism"          â”‚
â”‚                                                                      â”‚
â”‚  requirements      Other packages your model needs at runtime        â”‚
â”‚                    e.g. ["wrfhydro", "netcdf4"]                      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### â„¹ï¸ [info] Section â€” Package Metadata

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [info]                                                              â”‚
â”‚                                                                      â”‚
â”‚  github_username     GitHub org/user (default: "pymt-lab")           â”‚
â”‚  package_author      Author name                                     â”‚
â”‚  package_author_email  Contact email                                 â”‚
â”‚  package_license     License type (MIT, BSD, GPL, etc.)              â”‚
â”‚  summary             Short description of the package                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ”„ [ci] Section â€” Continuous Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ci]                                                                â”‚
â”‚                                                                      â”‚
â”‚  python_version     Python versions to test against                  â”‚
â”‚                     e.g. ["3.9", "3.10", "3.11"]                     â”‚
â”‚                                                                      â”‚
â”‚  os                 Operating systems to build for                   â”‚
â”‚                     e.g. ["linux", "mac", "windows"]                 â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5ï¸âƒ£ What babel.toml Would Look Like for WRF-Hydro

### ğŸ”µ Our Project's babel.toml (Hypothetical)

```toml
[library]
[library.WrfHydro]
language = "fortran"
library = "bmi_wrf_hydro"
entry_point = "bmi_wrf_hydro_module"

[build]
undef_macros = []
define_macros = ["USE_NWM_BMI"]
libraries = ["netcdf", "netcdff", "hdf5", "hdf5_hl"]
library_dirs = []
include_dirs = []
extra_compile_args = ["-O2"]

[package]
name = "pymt_wrfhydro"
requirements = ["netcdf4", "numpy"]

[info]
github_username = "pymt-lab"
package_author = "Your Name"
package_author_email = "you@university.edu"
package_license = "MIT"
summary = "PyMT plugin for WRF-Hydro / National Water Model"

[ci]
python_version = ["3.10", "3.11"]
os = ["linux"]
```

### ğŸŸ¢ And for SCHISM

```toml
[library]
[library.Schism]
language = "fortran"
library = "bmischism"
entry_point = "bmischism_module"

[build]
undef_macros = []
define_macros = ["USE_NWM_BMI"]
libraries = ["netcdf", "netcdff"]
library_dirs = []
include_dirs = []
extra_compile_args = []

[package]
name = "pymt_schism"
requirements = ["netcdf4", "numpy"]

[info]
github_username = "pymt-lab"
package_author = "Your Name"
package_author_email = "you@university.edu"
package_license = "MIT"
summary = "PyMT plugin for SCHISM coastal ocean model"

[ci]
python_version = ["3.10", "3.11"]
os = ["linux"]
```

---

## 6ï¸âƒ£ Babelizer CLI Commands

### ğŸ–¥ï¸ The Command Line Interface

The Babelizer provides these commands:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚  COMMAND                    WHAT IT DOES                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚                                                                      â”‚
â”‚  babelize sample-config     Generate a blank babel.toml template     â”‚
â”‚                             (great starting point!)                   â”‚
â”‚                                                                      â”‚
â”‚  babelize generate          Generate a babel.toml interactively      â”‚
â”‚                             (wizard-style Q&A)                        â”‚
â”‚                                                                      â”‚
â”‚  babelize init babel.toml   Generate the full Python package from    â”‚
â”‚                             your babel.toml file                     â”‚
â”‚                             THIS IS THE MAIN COMMAND                 â”‚
â”‚                                                                      â”‚
â”‚  babelize update            Update an existing babelized package     â”‚
â”‚                             (after changing babel.toml)               â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“‚ What `babelize init` Generates

When you run `babelize init babel.toml`, the Babelizer creates an entire Python package directory:

```
pymt_wrfhydro/
â”œâ”€â”€ babel.toml                 â† Your original config
â”œâ”€â”€ CHANGES.rst                â† Changelog
â”œâ”€â”€ LICENSE                    â† License file
â”œâ”€â”€ MANIFEST.in                â† Package manifest
â”œâ”€â”€ README.rst                 â† Auto-generated README
â”œâ”€â”€ docs/                      â† Documentation skeleton
â”œâ”€â”€ meta/                      â† Conda recipe
â”‚   â””â”€â”€ conda-forge/
â”‚       â””â”€â”€ meta.yaml
â”œâ”€â”€ pymt_wrfhydro/             â† The actual Python package
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ _version.py
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ _wrfhydro.pyx      â† AUTO-GENERATED Cython bindings!
â”œâ”€â”€ pyproject.toml             â† Modern Python build config
â”œâ”€â”€ recipe/                    â† Build recipes
â””â”€â”€ .github/
    â””â”€â”€ workflows/             â† CI/CD pipeline (GitHub Actions)
        â””â”€â”€ test.yml
```

The `_wrfhydro.pyx` file is the magic â€” it's a **Cython** file that the Babelizer auto-generates to bridge Python and Fortran. You never edit this file!

---

## 7ï¸âƒ£ How the Babelizer Works Internally

### âš™ï¸ Under the Hood

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                        â”‚
â”‚  YOUR FORTRAN BMI                                                      â”‚
â”‚  bmi_wrf_hydro.f90                                                     â”‚
â”‚  â”œâ”€â”€ Has 41 BMI subroutines                                           â”‚
â”‚  â””â”€â”€ Compiled into: libwrfhydro_bmi.so (shared library)               â”‚
â”‚         â”‚                                                              â”‚
â”‚         â”‚ The Babelizer generates...                                   â”‚
â”‚         â–¼                                                              â”‚
â”‚  CYTHON BRIDGE LAYER (auto-generated)                                  â”‚
â”‚  _wrfhydro.pyx                                                         â”‚
â”‚  â”œâ”€â”€ Imports Fortran symbols using ISO_C_BINDING                       â”‚
â”‚  â”œâ”€â”€ Creates a Python class "WrfHydro"                                 â”‚
â”‚  â”œâ”€â”€ Each Python method calls corresponding Fortran subroutine         â”‚
â”‚  â””â”€â”€ Handles data type conversion (Fortran arrays â†’ NumPy arrays)      â”‚
â”‚         â”‚                                                              â”‚
â”‚         â”‚ Compiled by Cython into...                                   â”‚
â”‚         â–¼                                                              â”‚
â”‚  COMPILED EXTENSION MODULE                                             â”‚
â”‚  _wrfhydro.cpython-310-x86_64-linux-gnu.so                            â”‚
â”‚  â”œâ”€â”€ Native machine code                                               â”‚
â”‚  â”œâ”€â”€ Loadable by Python's import system                                â”‚
â”‚  â””â”€â”€ FULL SPEED â€” no performance overhead!                             â”‚
â”‚         â”‚                                                              â”‚
â”‚         â”‚ Imported by...                                               â”‚
â”‚         â–¼                                                              â”‚
â”‚  PYTHON PACKAGE                                                        â”‚
â”‚  pymt_wrfhydro                                                         â”‚
â”‚  â”œâ”€â”€ from pymt_wrfhydro import WrfHydro                               â”‚
â”‚  â”œâ”€â”€ model = WrfHydro()                                                â”‚
â”‚  â””â”€â”€ model.update()  â† calls Fortran at full speed!                   â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”‘ Key Insight: ISO_C_BINDING

For Fortran models, the Babelizer relies on **Fortran's ISO_C_BINDING** feature (Fortran 2003+) to expose Fortran subroutines with C-compatible calling conventions. This is why Fortran 2003 is required (not older Fortran 90/95).

The `bmi-fortran` specification (https://github.com/csdms/bmi-fortran) already uses Fortran 2003 features:
- Type-bound procedures (methods inside a type)
- The `class` keyword for polymorphism
- `abstract interface` for the BMI contract

---

## 8ï¸âƒ£ Fortran-Specific Details

### ğŸ—ï¸ The Fortran BMI Spec

From the official `bmi-fortran` repository (https://github.com/csdms/bmi-fortran):

The Fortran 2003 BMI implementation acts as a **true interface** â€” it can be imported as a type from a module and its methods overridden.

**Two Fortran BMI versions exist:**

| Version | Fortran Standard | Recommended? | Repository |
|---------|-----------------|-------------|------------|
| `bmi-fortran` | Fortran 2003 | âœ… YES | https://github.com/csdms/bmi-fortran |
| `bmi-f90` | Fortran 90/95 | âŒ Legacy | https://github.com/csdms/bmi-f90 |

The Fortran 2003 version is strongly recommended because:
- True object-oriented (methods bound to types)
- Works directly with the Babelizer
- Uses `bmif_2_0` module with the `bmi` abstract type

### ğŸ“¦ Installing Fortran BMI Bindings

From the official docs, two options:

**Option A: conda (easiest)**
```
conda install -c conda-forge bmi-fortran
```

**Option B: Build from source with cmake**
```
git clone https://github.com/csdms/bmi-fortran
cd bmi-fortran
mkdir _build && cd _build
cmake .. -DCMAKE_INSTALL_PREFIX=$CONDA_PREFIX
make install
```

After installation, you get:
```
$CONDA_PREFIX/
â”œâ”€â”€ include/
â”‚   â””â”€â”€ bmif_2_0.mod          â† The Fortran module file
â””â”€â”€ lib/
    â”œâ”€â”€ libbmif.so            â† The BMI Fortran library
    â””â”€â”€ pkgconfig/
        â””â”€â”€ bmif.pc           â† pkg-config metadata
```

### ğŸ“ The Reference Example: Heat Model

CSDMS provides a complete Fortran BMI example at https://github.com/csdms/bmi-example-fortran:

- Solves diffusion equation on a uniform rectangular plate
- Demonstrates all 41 BMI functions in Fortran
- Includes a test driver program
- Perfect template for writing WRF-Hydro's BMI!

---

## 9ï¸âƒ£ The Complete Babelizer Pipeline for Our Project

### ğŸ—ºï¸ End-to-End Roadmap

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                        â”‚
â”‚  PHASE 1: PREPARATION                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚  â˜ Install Fortran BMI bindings (conda install bmi-fortran)            â”‚
â”‚  â˜ Study bmi-example-fortran as template                               â”‚
â”‚  â˜ Identify WRF-Hydro variables to expose                              â”‚
â”‚  â˜ Map internal names to CSDMS Standard Names                          â”‚
â”‚                                                                        â”‚
â”‚  PHASE 2: WRITE BMI WRAPPER                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚  â˜ Create bmi_wrf_hydro.f90                                            â”‚
â”‚  â˜ Implement all 41 BMI functions                                      â”‚
â”‚  â˜ Refactor WRF-Hydro time loop (IRF pattern)                          â”‚
â”‚  â˜ Compile as shared library (libwrfhydro_bmi.so)                      â”‚
â”‚  â˜ Test with a Fortran driver program                                  â”‚
â”‚                                                                        â”‚
â”‚  PHASE 3: BABELIZE                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚  â˜ Install babelizer (conda install babelizer)                         â”‚
â”‚  â˜ Write babel.toml (see Section 5 above)                              â”‚
â”‚  â˜ Run: babelize init babel.toml                                       â”‚
â”‚  â˜ Build: cd pymt_wrfhydro && pip install -e .                         â”‚
â”‚  â˜ Test: python -c "from pymt_wrfhydro import WrfHydro"               â”‚
â”‚                                                                        â”‚
â”‚  PHASE 4: VALIDATE                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚  â˜ Run bmi-tester on the babelized package                             â”‚
â”‚  â˜ Run model from Python, compare results to standalone                â”‚
â”‚  â˜ Submit to pymt-lab GitHub organization                              â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Ÿ Installation & Setup

### ğŸ“¦ From the Official Docs

**Install the Babelizer:**
```
conda create -n babelizer -c conda-forge python babelizer
conda activate babelizer
```

**Requirements:**
- Python >= 3.10
- conda (Anaconda or Miniconda)
- A C/Fortran compiler (gcc, gfortran)
- cmake (for building Fortran libraries)

**Additional tools you'll want:**
- `bmi-tester` â€” validates your BMI implementation
- `bmi-fortran` â€” the Fortran BMI specification
- `pymt` â€” the framework your plugin will run in

---

## 1ï¸âƒ£1ï¸âƒ£ Where Babelizer Fits in the CSDMS Workbench

### ğŸ§° The Ecosystem

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CSDMS WORKBENCH                                â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   BMI    â”‚    â”‚ Standard â”‚    â”‚Babelizer â”‚    â”‚  PyMT    â”‚    â”‚
â”‚  â”‚   Spec   â”‚â”€â”€â”€â†’â”‚  Names   â”‚â”€â”€â”€â†’â”‚          â”‚â”€â”€â”€â†’â”‚          â”‚    â”‚
â”‚  â”‚          â”‚    â”‚          â”‚    â”‚ Fortran  â”‚    â”‚ Coupling â”‚    â”‚
â”‚  â”‚ 41 funcs â”‚    â”‚ Variable â”‚    â”‚ â†’ Python â”‚    â”‚ Frameworkâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ naming   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚               â”‚           â”‚
â”‚                                       â–¼               â–¼           â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                  â”‚ Landlab  â”‚   â”‚ Data     â”‚     â”‚
â”‚                                  â”‚ (alt     â”‚   â”‚Componentsâ”‚     â”‚
â”‚                                  â”‚ framework)â”‚   â”‚(datasets)â”‚     â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                    â”‚
â”‚  You are HERE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â˜…                               â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£2ï¸âƒ£ Key Takeaways

### ğŸ’ What You Need to Remember

1. **Babelizer = Automatic Fortran-to-Python translator** for BMI models
2. **babel.toml = The recipe** â€” describes your library in 5 sections
3. **3 prerequisites:** correct language, shared library, BMI implementation
4. **The hard part is writing the BMI**, not the babelizing
5. **Output is a pip-installable Python package** (pymt_wrfhydro)
6. **Fortran 2003 required** (ISO_C_BINDING, type-bound procedures)
7. **Auto-generates:** Cython bindings, setup.py, CI config, README, conda recipe
8. **CSDMS will help!** Contact them via CSDMS Help Desk if you get stuck

---

## 1ï¸âƒ£3ï¸âƒ£ Key References

| Reference | Link |
|-----------|------|
| ğŸ“¦ Babelizer GitHub | https://github.com/csdms/babelizer |
| ğŸ“– Babelizer Docs | https://babelizer.readthedocs.io |
| ğŸŒ CSDMS Wiki: Babelizer | https://csdms.colorado.edu/wiki/Babelizer |
| ğŸ”Œ BMI Docs: Babelizer & PyMT | https://bmi.csdms.io/en/latest/csdms.html |
| ğŸ—ï¸ Fortran BMI Spec | https://github.com/csdms/bmi-fortran |
| ğŸ“ Fortran BMI Example (Heat Model) | https://github.com/csdms/bmi-example-fortran |
| ğŸ Anaconda Package | https://anaconda.org/conda-forge/babelizer |
| ğŸ§° CSDMS Workbench | https://csdms.colorado.edu/wiki/Workbench |
| ğŸ’¬ CSDMS Help Desk | https://github.com/csdms/help-desk |

---

*Document based exclusively on official CSDMS documentation, GitHub repositories, and ReadTheDocs pages.*
*Prepared for WRF-Hydro / SCHISM coupling project context.*
