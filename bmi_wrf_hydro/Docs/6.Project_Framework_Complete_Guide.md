# ğŸŒŠ Complete Project Framework & Guide
## WRF-Hydro + SCHISM Compound Flooding Coupling
### BMI â†’ Standard Names â†’ Babelizer â†’ PyMT

---

> **Project Goal:** Make WRF-Hydro BMI-compliant, create PyMT plugins for both WRF-Hydro and SCHISM, and couple them for compound flooding simulations â€” all controllable from Python.

---

## ğŸ“š Official Sources Referenced Throughout This Document

| Source | URL |
|--------|-----|
| BMI Specification | https://bmi.csdms.io |
| BMI GitHub | https://github.com/csdms/bmi |
| CSDMS Standard Names | https://csdms.colorado.edu/wiki/CSDMS_Standard_Names |
| Standard Names Registry | https://github.com/csdms/standard_names_registry |
| Babelizer GitHub | https://github.com/csdms/babelizer |
| Babelizer Docs | https://babelizer.readthedocs.io |
| PyMT GitHub | https://github.com/csdms/pymt |
| PyMT Docs | https://pymt.readthedocs.io |
| CSDMS Workbench | https://csdms.colorado.edu/wiki/Workbench |
| Fortran BMI Spec | https://github.com/csdms/bmi-fortran |
| Fortran BMI Example | https://github.com/csdms/bmi-example-fortran |
| SCHISM BMI Repo | https://github.com/schism-dev/schism_NWM_BMI |
| Hutton et al. 2020 (BMI 2.0) | doi:10.21105/joss.02317 |
| Peckham 2014 (Standard Names) | https://csdms.colorado.edu/w/images/Peckham_2014_iEMSs.pdf |

---

# PART 1: BABELIZER vs PyMT â€” The Simple Explanation

---

## 1ï¸âƒ£ The Cooking Analogy

The simplest way to understand the difference:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸ”® BABELIZER = The Kitchen Equipment Installer                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚   Takes your Fortran/C/C++ model and CONVERTS it into                   â”‚
â”‚   a Python package. That's ALL it does.                                 â”‚
â”‚                                                                          â”‚
â”‚   You use it ONCE per model. Then you're done with it forever.          â”‚
â”‚   It's a BUILD-TIME tool.                                               â”‚
â”‚                                                                          â”‚
â”‚                                                                          â”‚
â”‚   ğŸ§° PyMT = The Chef                                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚   Takes those Python packages and actually RUNS them,                   â”‚
â”‚   CONNECTS them together, PASSES data between them,                     â”‚
â”‚   handles different grid sizes, synchronizes time steps.                â”‚
â”‚                                                                          â”‚
â”‚   You use it EVERY TIME you run a simulation.                           â”‚
â”‚   It's a RUN-TIME framework.                                            â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2ï¸âƒ£ The Phone Analogy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸ”® Babelizer = The App Store Developer Tools                          â”‚
â”‚   Converts your model into an "app" (Python package)                    â”‚
â”‚   that can be installed on the "phone" (PyMT).                          â”‚
â”‚   You build the app once, then it's ready.                              â”‚
â”‚                                                                          â”‚
â”‚   ğŸ§° PyMT = The Phone's Operating System (Android/iOS)                  â”‚
â”‚   The OS that runs the apps, lets them talk to each other,              â”‚
â”‚   share data, and work together.                                        â”‚
â”‚   You use the OS every time you pick up the phone.                      â”‚
â”‚                                                                          â”‚
â”‚   ğŸ“± pymt_wrfhydro = App 1 (WRF-Hydro plugin)                          â”‚
â”‚   ğŸ“± pymt_schism   = App 2 (SCHISM plugin)                              â”‚
â”‚                                                                          â”‚
â”‚   Both apps installed on ONE phone (ONE PyMT framework).                â”‚
â”‚   The OS (PyMT) lets them exchange data seamlessly.                     â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3ï¸âƒ£ Side-by-Side Comparison

| Feature | ğŸ”® Babelizer | ğŸ§° PyMT |
|---------|-------------|---------|
| **What it does** | Converts BMI model â†’ Python package | Runs & couples Python model packages |
| **When you use it** | Once per model (build time) | Every simulation (run time) |
| **Input** | Fortran/C/C++ BMI library + `babel.toml` | Babelized Python packages (plugins) |
| **Output** | A pip-installable Python package | Coupled model simulation results |
| **How many times** | Use twice for our project (once per model) | Use once (one framework for both) |
| **Analogy** | App Store Developer Tools | Phone Operating System |
| **ML Analogy** | pybind11 / SWIG (language bindings) | Hugging Face / Lightning (framework) |
| **Official source** | https://github.com/csdms/babelizer | https://github.com/csdms/pymt |

## 4ï¸âƒ£ How Many of Each Do We Need?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸ”® BABELIZER: Used TWICE (once per model)                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚                                                                          â”‚
â”‚   Run 1: Babelize WRF-Hydro  â†’  produces "pymt_wrfhydro" package       â”‚
â”‚   Run 2: Babelize SCHISM     â†’  produces "pymt_schism" package          â”‚
â”‚                                                                          â”‚
â”‚   After that, Babelizer's job is DONE. You never touch it again.        â”‚
â”‚                                                                          â”‚
â”‚                                                                          â”‚
â”‚   ğŸ§° PyMT: Only ONE framework                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚                                                                          â”‚
â”‚   ONE PyMT installation loads BOTH plugins:                              â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚              ONE PyMT Framework                      â”‚               â”‚
â”‚   â”‚                                                     â”‚               â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚               â”‚
â”‚   â”‚   â”‚ pymt_wrfhydroâ”‚â—„â”€â”€DATAâ”€â”€â–ºâ”‚ pymt_schism  â”‚        â”‚               â”‚
â”‚   â”‚   â”‚  (plugin 1)  â”‚         â”‚  (plugin 2)  â”‚        â”‚               â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚               â”‚
â”‚   â”‚                                                     â”‚               â”‚
â”‚   â”‚   PyMT handles: grid mapping, time sync,           â”‚               â”‚
â”‚   â”‚   data exchange, unit conversion, NetCDF output    â”‚               â”‚
â”‚   â”‚                                                     â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                          â”‚
â”‚   We have 2 PLUGINS but only 1 FRAMEWORK.                               â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5ï¸âƒ£ The One-Line Summary

> **Babelizer BUILDS the plugins (twice). PyMT RUNS and COUPLES the plugins (one framework).**

---

# PART 2: CURRENT STATUS OF OUR TWO MODELS

---

## 6ï¸âƒ£ Where We Stand Today

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚                          CURRENT STATUS                                  â”‚
â”‚                                                                          â”‚
â”‚   ğŸŸ¢ SCHISM (Coastal Ocean Model)                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚                                                                          â”‚
â”‚   âœ… BMI-Compliant         File: bmischism.f90                          â”‚
â”‚                            Repo: schism-dev/schism_NWM_BMI              â”‚
â”‚                            Authors: Jason Ducker (NOAA OWP) +           â”‚
â”‚                                     Joseph Zhang (VIMS)                 â”‚
â”‚                            Mode: Serial (single thread, no MPI)         â”‚
â”‚                            Flag: USE_NWM_BMI (CPP preprocessor)         â”‚
â”‚                            Designed for: NOAA NextGen framework         â”‚
â”‚                                                                          â”‚
â”‚   âŒ No PyMT Plugin        pymt_schism does NOT exist yet               â”‚
â”‚                            Must babelize bmischism.f90                   â”‚
â”‚                                                                          â”‚
â”‚                                                                          â”‚
â”‚   ğŸ”µ WRF-Hydro / National Water Model                                   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚                                                                          â”‚
â”‚   âŒ NOT BMI-Compliant     No BMI wrapper exists at all                 â”‚
â”‚                            Runs as standalone Fortran program            â”‚
â”‚                            Uses namelists (namelist.hrldas) for config  â”‚
â”‚                            Has integrated time loop (cannot be          â”‚
â”‚                            externally controlled step-by-step)          â”‚
â”‚                                                                          â”‚
â”‚   âŒ No PyMT Plugin        pymt_wrfhydro does NOT exist yet             â”‚
â”‚                            Must write BMI first, then babelize          â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š Status Summary Table

| Component | SCHISM | WRF-Hydro |
|-----------|--------|-----------|
| Original Language | Fortran | Fortran |
| BMI Wrapper | âœ… bmischism.f90 exists | âŒ Must write from scratch |
| Standard Names Mapping | âš ï¸ Uses simple names, needs mapping | âŒ Must create mapping |
| Shared Library (.so) | âš ï¸ Must configure build | âŒ Must reconfigure cmake |
| Babelized? | âŒ Not yet | âŒ Not yet |
| PyMT Plugin? | âŒ Not yet | âŒ Not yet |
| Coupleable from Python? | âŒ Not yet | âŒ Not yet |

---

# PART 3: THE COMPLETE FRAMEWORK â€” ALL 5 LAYERS

---

## 7ï¸âƒ£ The 5-Layer Architecture

Our project has 5 layers, from bottom (existing models) to top (scientist using Python):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   LAYER 5 (TOP): ğŸ‘©â€ğŸ”¬ SCIENTIST / JUPYTER NOTEBOOK                       â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                       â”‚
â”‚   The end user writes Python code in Jupyter.                           â”‚
â”‚   Calls: wrfhydro.update(), schism.get_value(), etc.                    â”‚
â”‚   Can visualize results, adjust parameters, run experiments.            â”‚
â”‚   NO knowledge of Fortran needed!                                       â”‚
â”‚                                                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚                                                                          â”‚
â”‚   LAYER 4: ğŸ§° PyMT FRAMEWORK                                           â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                           â”‚
â”‚   The coupling orchestrator.                                            â”‚
â”‚   Handles: grid mapping (1km regular â†’ unstructured triangles),         â”‚
â”‚   time synchronization (hourly vs 100-second steps),                    â”‚
â”‚   data exchange, unit conversion, Standard Names matching,              â”‚
â”‚   NetCDF output writing.                                                â”‚
â”‚   Source: https://github.com/csdms/pymt                                â”‚
â”‚                                                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚                                                                          â”‚
â”‚   LAYER 3: ğŸ”® BABELIZED PLUGINS (Python Packages)                      â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                       â”‚
â”‚   pymt_wrfhydro â€” WRF-Hydro as a Python class                          â”‚
â”‚   pymt_schism   â€” SCHISM as a Python class                              â”‚
â”‚   Created by Babelizer from the Fortran BMI wrappers.                   â”‚
â”‚   Auto-generated Cython bindings bridge Python â†” Fortran.              â”‚
â”‚   Source: https://github.com/csdms/babelizer                           â”‚
â”‚                                                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚                                                                          â”‚
â”‚   LAYER 2: ğŸ”Œ BMI WRAPPERS + ğŸ“› STANDARD NAMES                        â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                       â”‚
â”‚   bmi_wrf_hydro.f90 â€” 41 BMI functions wrapping WRF-Hydro             â”‚
â”‚   bmischism.f90      â€” 41 BMI functions wrapping SCHISM (EXISTS!)      â”‚
â”‚   Each wrapper includes a Standard Names mapping dictionary.            â”‚
â”‚   e.g., "QLINK1" â†’ "channel_water__volume_flow_rate"                  â”‚
â”‚   Source: https://bmi.csdms.io                                         â”‚
â”‚   Source: https://csdms.colorado.edu/wiki/CSDMS_Standard_Names         â”‚
â”‚                                                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚                                                                          â”‚
â”‚   LAYER 1 (BOTTOM): ğŸ’§ğŸŒŠ ORIGINAL MODELS (Fortran)                    â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                     â”‚
â”‚   WRF-Hydro: Land surface, soil, routing, channel, groundwater         â”‚
â”‚   SCHISM: Tides, storm surge, baroclinic circulation, waves            â”‚
â”‚   Running at FULL NATIVE FORTRAN SPEED â€” zero performance penalty!     â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# PART 4: EACH TOOL EXPLAINED IN DETAIL

---

## 8ï¸âƒ£ Layer 1: The Original Models

### ğŸ’§ WRF-Hydro (Weather Research & Forecasting â€” Hydrological Extension)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸ’§ WRF-Hydro â€” What It Computes                                      â”‚
â”‚                                                                          â”‚
â”‚   Layer 1: â˜ï¸  Atmospheric Forcing                                      â”‚
â”‚            Reads rainfall, temperature, humidity, wind, radiation        â”‚
â”‚            from files or WRF atmospheric model output                    â”‚
â”‚                                                                          â”‚
â”‚   Layer 2: ğŸŒ± Land Surface (Noah-MP)                                    â”‚
â”‚            Computes evapotranspiration, snow melt, soil moisture,        â”‚
â”‚            canopy interception, surface energy balance                   â”‚
â”‚                                                                          â”‚
â”‚   Layer 3: ğŸ”ï¸  Terrain Routing                                          â”‚
â”‚            Routes surface water overland (sheet flow)                    â”‚
â”‚            Resolution: typically 250m grid                               â”‚
â”‚                                                                          â”‚
â”‚   Layer 4: ğŸï¸  Channel Routing                                          â”‚
â”‚            Routes water through river channels                           â”‚
â”‚            Uses Muskingum-Cunge method                                   â”‚
â”‚            Produces: STREAMFLOW (the key output!)                       â”‚
â”‚                                                                          â”‚
â”‚   Layer 5: ğŸ’ Groundwater (optional)                                    â”‚
â”‚            Bucket model for baseflow                                     â”‚
â”‚            Exchanges with soil and channels                              â”‚
â”‚                                                                          â”‚
â”‚   Grid: Uniform rectilinear (typically 1km for routing, 250m terrain)  â”‚
â”‚   Time step: ~1 hour for land surface, sub-hourly for routing           â”‚
â”‚   Language: Fortran 90                                                   â”‚
â”‚   Config: namelist.hrldas + hydro.namelist                              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸŒŠ SCHISM (Semi-implicit Cross-scale Hydroscience Integrated System Model)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸŒŠ SCHISM â€” What It Computes                                          â”‚
â”‚                                                                          â”‚
â”‚   Module 1: ğŸŒ™ Tidal Forcing                                            â”‚
â”‚             Astronomical tides from boundary conditions                  â”‚
â”‚                                                                          â”‚
â”‚   Module 2: ğŸŒªï¸  Storm Surge                                             â”‚
â”‚             Wind and pressure-driven water level changes                â”‚
â”‚                                                                          â”‚
â”‚   Module 3: ğŸ”„ Baroclinic Circulation                                   â”‚
â”‚             3D temperature and salinity-driven currents                  â”‚
â”‚                                                                          â”‚
â”‚   Module 4: ğŸŒŠ Wave-Current Interaction (optional, via WWM)             â”‚
â”‚             Coupled wave effects on circulation                         â”‚
â”‚                                                                          â”‚
â”‚   Module 5: ğŸ§ª Water Quality / Sediment (optional)                      â”‚
â”‚             Tracers, nutrients, sediment transport                       â”‚
â”‚                                                                          â”‚
â”‚   Grid: UNSTRUCTURED triangular mesh                                    â”‚
â”‚          Fine triangles near coast (meters)                              â”‚
â”‚          Coarse triangles in deep ocean (kilometers)                    â”‚
â”‚   Time step: ~100 seconds (semi-implicit scheme)                        â”‚
â”‚   Language: Fortran 90/2003                                              â”‚
â”‚   Config: param.nml + various input files                               â”‚
â”‚                                                                          â”‚
â”‚   BMI Status: âœ… bmischism.f90 EXISTS in schism-dev/schism_NWM_BMI     â”‚
â”‚   Developed by: Jason Ducker (NOAA OWP) + Joseph Zhang (VIMS)          â”‚
â”‚   Mode: Serial only (no MPI, no ghost nodes)                            â”‚
â”‚   CPP Flag: USE_NWM_BMI                                                 â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¤ Why They Need Each Other: Compound Flooding

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚                    ğŸŒ§ï¸ COMPOUND FLOODING                                  â”‚
â”‚                                                                          â”‚
â”‚   Compound flooding happens when MULTIPLE flood sources                  â”‚
â”‚   hit the same area at the same time:                                    â”‚
â”‚                                                                          â”‚
â”‚   â˜ï¸ Heavy rainfall upstream (WRF-Hydro domain)                         â”‚
â”‚      +                                                                   â”‚
â”‚   ğŸŒŠ Storm surge from ocean (SCHISM domain)                             â”‚
â”‚      +                                                                   â”‚
â”‚   ğŸŒ™ High tide (SCHISM domain)                                          â”‚
â”‚      =                                                                   â”‚
â”‚   ğŸ’¥ DEVASTATING FLOODING at the coast where rivers meet the ocean      â”‚
â”‚                                                                          â”‚
â”‚   Neither model alone can capture this!                                  â”‚
â”‚                                                                          â”‚
â”‚   WRF-Hydro alone: Knows about rain and rivers                         â”‚
â”‚                     but ignores ocean water levels pushing BACK          â”‚
â”‚                     into rivers (backwater effect)                       â”‚
â”‚                                                                          â”‚
â”‚   SCHISM alone:    Knows about tides and storm surge                    â”‚
â”‚                     but ignores freshwater river discharge               â”‚
â”‚                     flowing INTO the ocean                               â”‚
â”‚                                                                          â”‚
â”‚   COUPLED:         WRF-Hydro sends river discharge â†’ SCHISM            â”‚
â”‚                     SCHISM sends coastal water levels â†’ WRF-Hydro       â”‚
â”‚                     BOTH models see the FULL picture!                    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9ï¸âƒ£ Layer 2: BMI (Basic Model Interface)

### ğŸ”Œ What BMI Does

From the official BMI docs (https://bmi.csdms.io):

> *"A standardized set of control and query functions that, when added to a model, makes it easier to couple with other software."*

BMI is a **specification** â€” a contract that says: "If your model implements these 41 functions, ANY framework can control it."

### ğŸ“‹ The 41 Functions at a Glance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸ”´ CONTROL (4 functions) â€” Lifecycle management                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚   initialize(config_file)     Start up, read config, allocate memory    â”‚
â”‚   update()                    Advance exactly ONE time step              â”‚
â”‚   update_until(time)          Advance until reaching target time        â”‚
â”‚   finalize()                  Cleanup, free memory, close files         â”‚
â”‚                                                                          â”‚
â”‚   ğŸŸ£ MODEL INFO (4 functions) â€” Self-description                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚   get_component_name()        Returns model name string                 â”‚
â”‚   get_input_item_count()      How many input variables?                 â”‚
â”‚   get_output_item_count()     How many output variables?                â”‚
â”‚   get_input/output_var_names() Lists of all variable names              â”‚
â”‚                                                                          â”‚
â”‚   ğŸ”µ VARIABLE INFO (6 functions) â€” Variable metadata                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚   get_var_type(name)          Data type (float64, int32)                â”‚
â”‚   get_var_units(name)         Physical units (m3/s, kg, K)              â”‚
â”‚   get_var_grid(name)          Which grid ID this variable uses          â”‚
â”‚   get_var_itemsize(name)      Bytes per element                        â”‚
â”‚   get_var_nbytes(name)        Total bytes for entire array              â”‚
â”‚   get_var_location(name)      node, edge, or face                      â”‚
â”‚                                                                          â”‚
â”‚   ğŸŸ¢ TIME (5 functions) â€” Temporal information                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚   get_current_time()          Current simulation time                   â”‚
â”‚   get_start_time()            Start time                                â”‚
â”‚   get_end_time()              End time                                  â”‚
â”‚   get_time_step()             Size of one step                          â”‚
â”‚   get_time_units()            Time units string                        â”‚
â”‚                                                                          â”‚
â”‚   ğŸŸ¡ GET/SET (5 functions) â€” THE COUPLING KEY! â­                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚   get_value(name, dest)       Read variable data OUT of model           â”‚
â”‚   set_value(name, src)        Write external data INTO model            â”‚
â”‚   get_value_ptr(name)         Direct pointer (optional)                 â”‚
â”‚   get_value_at_indices()      Read at specific locations                â”‚
â”‚   set_value_at_indices()      Write at specific locations               â”‚
â”‚                                                                          â”‚
â”‚   ğŸ”µ GRID (17 functions) â€” Spatial structure                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚   get_grid_type/rank/size()   Basic grid properties                    â”‚
â”‚   get_grid_shape/spacing/origin()  For structured grids                â”‚
â”‚   get_grid_x/y/z()           Coordinate arrays                        â”‚
â”‚   get_grid_node/edge/face_count()  For unstructured grids              â”‚
â”‚   get_grid_edge_nodes()       Edge connectivity                        â”‚
â”‚   get_grid_face_nodes()       Face connectivity                        â”‚
â”‚   get_grid_face_edges()       Face-edge connectivity                   â”‚
â”‚   get_grid_nodes_per_face()   Nodes per face (3=tri, 4=quad)           â”‚
â”‚                                                                          â”‚
â”‚   TOTAL: 4 + 4 + 6 + 5 + 5 + 17 = 41 functions                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âš ï¸ The Hardest Part: IRF Refactoring

The most difficult part of adding BMI to WRF-Hydro is **breaking the time loop** (from https://bmi.csdms.io/en/latest/bmi.best_practices.html):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   BEFORE (WRF-Hydro today):                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚                                                                          â”‚
â”‚   program wrf_hydro_main           â† One big program                    â”‚
â”‚     call read_config()             â† Setup                              â”‚
â”‚     call allocate_memory()                                               â”‚
â”‚     do t = 1, num_timesteps        â† TIME LOOP IS INSIDE               â”‚
â”‚       call compute_land_surface()                                        â”‚
â”‚       call route_terrain()                                               â”‚
â”‚       call route_channels()                                              â”‚
â”‚     end do                                                               â”‚
â”‚     call cleanup()                 â† Finalize                           â”‚
â”‚   end program                                                            â”‚
â”‚                                                                          â”‚
â”‚   Problem: You can't stop the model mid-loop to exchange data!          â”‚
â”‚                                                                          â”‚
â”‚                                                                          â”‚
â”‚   AFTER (with BMI):                                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚                                                                          â”‚
â”‚   module bmi_wrf_hydro             â† BMI wrapper                        â”‚
â”‚     subroutine initialize(config)  â† Setup only, NO time loop          â”‚
â”‚       call read_config()                                                 â”‚
â”‚       call allocate_memory()                                             â”‚
â”‚     end subroutine                                                       â”‚
â”‚                                                                          â”‚
â”‚     subroutine update()            â† ONE step only                      â”‚
â”‚       call compute_land_surface()                                        â”‚
â”‚       call route_terrain()                                               â”‚
â”‚       call route_channels()                                              â”‚
â”‚       current_time = current_time + dt                                   â”‚
â”‚     end subroutine                                                       â”‚
â”‚                                                                          â”‚
â”‚     subroutine finalize()          â† Cleanup                            â”‚
â”‚       call cleanup()                                                     â”‚
â”‚     end subroutine                                                       â”‚
â”‚   end module                                                             â”‚
â”‚                                                                          â”‚
â”‚   Now: The CALLER controls the time loop!                               â”‚
â”‚         PyMT can call update(), exchange data, call update() again...   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Ÿ Layer 2 (continued): CSDMS Standard Names

### ğŸ“› The Universal Variable Language

From the official CSDMS docs (https://csdms.colorado.edu/wiki/CSDMS_Standard_Names):

Standard Names solve the problem where every model invents its own variable names. They follow the pattern:

```
<object>__<quantity>       (separated by DOUBLE underscore)
```

### ğŸ“‹ The Names That Connect WRF-Hydro and SCHISM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸ’§ WRF-Hydro OUTPUTS â†’ Standard Name â†’ ğŸŒŠ SCHISM INPUTS             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                â”‚
â”‚                                                                          â”‚
â”‚   WRF-Hydro          Standard Name                    SCHISM             â”‚
â”‚   Internal           (the universal key)              Internal           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚   QLINK1       â†’  channel_water__volume_flow_rate  â†’  discharge         â”‚
â”‚   sfcheadrt    â†’  land_surface_water__depth        â†’  (boundary)        â”‚
â”‚   UGDRNOFF     â†’  soil_water__baseflow_volume_flux â†’  (boundary)        â”‚
â”‚                                                                          â”‚
â”‚                                                                          â”‚
â”‚   ğŸŒŠ SCHISM OUTPUTS â†’ Standard Name â†’ ğŸ’§ WRF-Hydro INPUTS             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                â”‚
â”‚                                                                          â”‚
â”‚   SCHISM           Standard Name                    WRF-Hydro            â”‚
â”‚   Internal         (the universal key)              Internal             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚   elev       â†’  sea_water_surface__elevation     â†’  (boundary)          â”‚
â”‚   dahv       â†’  sea_water__depth_averaged_       â†’  (boundary)          â”‚
â”‚                  x_velocity                                              â”‚
â”‚                                                                          â”‚
â”‚   MATCHING WORKS because both models map to the SAME standard name!     â”‚
â”‚   PyMT sees "channel_water__volume_flow_rate" on both sides             â”‚
â”‚   and automatically connects them!                                      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”‘ Key Rule (from Peckham, 2014)

> *"Model developers do NOT replace variables in their code with CSDMS Standard Names. They only need to provide a **mapping** (e.g., a Python dictionary) of their input and output variables to CSDMS Standard Names."*

Your Fortran code keeps `QLINK1`. Your BMI wrapper has a dictionary that says `QLINK1 = "channel_water__volume_flow_rate"`.

---

## 1ï¸âƒ£1ï¸âƒ£ Layer 3: The Babelizer

### ğŸ”® The Automatic Translator

From the official Babelizer docs (https://github.com/csdms/babelizer):

> *"The Babelizer is an open source Python utility for wrapping models that expose a BMI so they can be imported as Python packages."*

### ğŸ“‹ What the Babelizer Needs (3 Prerequisites)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   âœ… Prerequisite 1: Language must be C, C++, Fortran, or Python        â”‚
â”‚      WRF-Hydro = Fortran âœ…    SCHISM = Fortran âœ…                     â”‚
â”‚                                                                          â”‚
â”‚   âœ… Prerequisite 2: Model must compile as a SHARED LIBRARY (.so)       â”‚
â”‚      WRF-Hydro = needs cmake reconfiguration âš ï¸                        â”‚
â”‚      SCHISM = needs cmake reconfiguration âš ï¸                            â”‚
â”‚                                                                          â”‚
â”‚   âœ… Prerequisite 3: Model must implement all 41 BMI functions          â”‚
â”‚      WRF-Hydro = must WRITE from scratch âŒ (our main task!)           â”‚
â”‚      SCHISM = bmischism.f90 EXISTS âœ…                                   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ What the Babelizer Produces

You give it a `babel.toml` config file. It generates a complete Python package:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   INPUT: babel.toml                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚  [library.WrfHydro]                          â”‚                      â”‚
â”‚   â”‚  language = "fortran"                        â”‚                      â”‚
â”‚   â”‚  library = "bmi_wrf_hydro"                   â”‚                      â”‚
â”‚   â”‚  entry_point = "bmi_wrf_hydro_module"        â”‚                      â”‚
â”‚   â”‚                                              â”‚                      â”‚
â”‚   â”‚  [package]                                   â”‚                      â”‚
â”‚   â”‚  name = "pymt_wrfhydro"                      â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                          â”‚                                               â”‚
â”‚                          â–¼  babelize init babel.toml                     â”‚
â”‚                                                                          â”‚
â”‚   OUTPUT: Complete Python package                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚  pymt_wrfhydro/                              â”‚                      â”‚
â”‚   â”‚  â”œâ”€â”€ pymt_wrfhydro/                          â”‚                      â”‚
â”‚   â”‚  â”‚   â”œâ”€â”€ __init__.py                         â”‚                      â”‚
â”‚   â”‚  â”‚   â””â”€â”€ lib/                                â”‚                      â”‚
â”‚   â”‚  â”‚       â””â”€â”€ _wrfhydro.pyx  â† AUTO Cython!  â”‚                      â”‚
â”‚   â”‚  â”œâ”€â”€ pyproject.toml                          â”‚                      â”‚
â”‚   â”‚  â”œâ”€â”€ setup.py                                â”‚                      â”‚
â”‚   â”‚  â”œâ”€â”€ README.rst                              â”‚                      â”‚
â”‚   â”‚  â””â”€â”€ .github/workflows/test.yml             â”‚                      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                          â”‚
â”‚   Now you can do:                                                        â”‚
â”‚   pip install .                                                          â”‚
â”‚   python -c "from pymt_wrfhydro import WrfHydro"                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£2ï¸âƒ£ Layer 4: PyMT (Python Modeling Toolkit)

### ğŸ§° The Coupling Framework

From the official PyMT docs (https://github.com/csdms/pymt):

> *"pymt is an Open Source Python package that provides the necessary tools used for the coupling of models that expose the Basic Model Interface (BMI)."*

### ğŸ›ï¸ PyMT's 6 Pillars

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   PILLAR 1: ğŸ—ºï¸  GRID MAPPERS                                           â”‚
â”‚   Interpolates data between different grid types.                        â”‚
â”‚   WRF-Hydro: 1km uniform rectilinear (like a chessboard)               â”‚
â”‚   SCHISM: Unstructured triangular mesh (like a jigsaw puzzle)           â”‚
â”‚   PyMT's mappers handle this automatically using spatial indexing.       â”‚
â”‚                                                                          â”‚
â”‚   PILLAR 2: â±ï¸  TIME STEPPERS                                           â”‚
â”‚   Synchronizes models with different time steps.                         â”‚
â”‚   WRF-Hydro: ~1 hour per step                                          â”‚
â”‚   SCHISM: ~100 seconds per step                                         â”‚
â”‚   Both advance to common synchronization points.                        â”‚
â”‚                                                                          â”‚
â”‚   PILLAR 3: ğŸ“¤ğŸ“¥ DATA EXCHANGE                                          â”‚
â”‚   The get_value â†’ transform â†’ set_value pipeline.                       â”‚
â”‚   Includes automatic unit conversion via UDUNITS.                       â”‚
â”‚                                                                          â”‚
â”‚   PILLAR 4: ğŸ”Œ AUTO-LOADING WRAPPERS                                    â”‚
â”‚   Babelized packages automatically appear in PyMT.                      â”‚
â”‚   Just: from pymt.models import WrfHydro, Schism                       â”‚
â”‚                                                                          â”‚
â”‚   PILLAR 5: ğŸ“› STANDARDS UTILITIES                                      â”‚
â”‚   Supports UGRID, SGRID, CSDMS Standard Names.                         â”‚
â”‚   Automatic variable matching by Standard Name.                         â”‚
â”‚                                                                          â”‚
â”‚   PILLAR 6: ğŸ§© PLUGIN FRAMEWORK                                         â”‚
â”‚   Any babelized model becomes a PyMT plugin.                            â”‚
â”‚   Community can add models incrementally.                                â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ’¡ What PyMT ADDS Beyond Raw BMI

From https://bmi.csdms.io/en/latest/csdms.html:

> *"Within pymt, a component automatically gains many new capabilities. This includes the ability to be coupled to other models even if their **programming language, variable names, variable units, time-stepping scheme or computational grid** is different."*

| Raw BMI Alone | With PyMT |
|--------------|-----------|
| Must manually call get/set_value | Automatic data exchange pipeline |
| Must manually track time | Time steppers handle synchronization |
| Must manually interpolate grids | Grid mappers do it automatically |
| Must manually convert units | UDUNITS conversion built in |
| Must write own output code | NetCDF output built in |
| Must write coupling scripts | Standard patterns provided |

---

## 1ï¸âƒ£3ï¸âƒ£ Layer 5: The End Vision

### ğŸ‘©â€ğŸ”¬ What Success Looks Like

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   A scientist opens a Jupyter Notebook and types:                       â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚  from pymt.models import WrfHydro, Schism                      â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚  # Create both models                                          â”‚   â”‚
â”‚   â”‚  wrfhydro = WrfHydro()                                         â”‚   â”‚
â”‚   â”‚  schism = Schism()                                              â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚  # Initialize                                                   â”‚   â”‚
â”‚   â”‚  wrfhydro.initialize(*wrfhydro.setup())                         â”‚   â”‚
â”‚   â”‚  schism.initialize(*schism.setup())                             â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚  # Run coupled simulation for 24 hours                         â”‚   â”‚
â”‚   â”‚  for hour in range(24):                                         â”‚   â”‚
â”‚   â”‚      target = (hour + 1) * 3600                                 â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚      wrfhydro.update_until(target)                              â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚      discharge = wrfhydro.get_value(                            â”‚   â”‚
â”‚   â”‚          "channel_water__volume_flow_rate")                     â”‚   â”‚
â”‚   â”‚      schism.set_value(                                          â”‚   â”‚
â”‚   â”‚          "channel_water__volume_flow_rate", discharge)          â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚      schism.update_until(target)                                â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚      water_level = schism.get_value(                            â”‚   â”‚
â”‚   â”‚          "sea_water_surface__elevation")                        â”‚   â”‚
â”‚   â”‚      wrfhydro.set_value(                                        â”‚   â”‚
â”‚   â”‚          "sea_water_surface__elevation", water_level)           â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚  wrfhydro.finalize()                                            â”‚   â”‚
â”‚   â”‚  schism.finalize()                                              â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚   That's it. Compound flooding simulation in ~20 lines of Python.       â”‚
â”‚   Two Fortran models coupled seamlessly. No Fortran knowledge needed.   â”‚
â”‚   Grid mapping, time sync, unit conversion â€” all handled by PyMT.      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# PART 5: THE PROJECT ROADMAP

---

## 1ï¸âƒ£4ï¸âƒ£ The 4-Phase Plan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   PHASE 1: ğŸ”Œ WRITE BMI WRAPPER FOR WRF-HYDRO                          â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                          â”‚
â”‚   Status: âŒ NOT STARTED â€” THIS IS THE MAIN WORK                       â”‚
â”‚   Difficulty: â­â­â­â­â­ (hardest phase)                               â”‚
â”‚                                                                          â”‚
â”‚   Tasks:                                                                 â”‚
â”‚   â˜ Study bmi-example-fortran as template                               â”‚
â”‚     (https://github.com/csdms/bmi-example-fortran)                      â”‚
â”‚   â˜ Install Fortran BMI bindings                                         â”‚
â”‚     (https://github.com/csdms/bmi-fortran)                              â”‚
â”‚   â˜ Identify WRF-Hydro variables to expose (start with 5-10)           â”‚
â”‚   â˜ Create CSDMS Standard Names mapping dictionary                      â”‚
â”‚   â˜ Refactor WRF-Hydro time loop (IRF pattern)                          â”‚
â”‚   â˜ Write bmi_wrf_hydro.f90 (all 41 functions)                          â”‚
â”‚   â˜ Compile as shared library (libwrfhydro_bmi.so)                      â”‚
â”‚   â˜ Write a Fortran test driver to validate BMI                         â”‚
â”‚                                                                          â”‚
â”‚   Key decisions:                                                         â”‚
â”‚   â€¢ Serial first (no MPI) â€” like SCHISM's BMI approach                  â”‚
â”‚   â€¢ Start with channel discharge + soil moisture + snow                 â”‚
â”‚   â€¢ Use CPP flag: USE_NWM_BMI (following SCHISM's pattern)              â”‚
â”‚   â€¢ Config: pass-through to existing namelists initially                â”‚
â”‚                                                                          â”‚
â”‚                                                                          â”‚
â”‚   PHASE 2: ğŸ”® BABELIZE BOTH MODELS                                      â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
â”‚   Status: âŒ WAITING (needs Phase 1)                                    â”‚
â”‚   Difficulty: â­â­ (mostly automated)                                   â”‚
â”‚                                                                          â”‚
â”‚   Tasks:                                                                 â”‚
â”‚   â˜ Install babelizer (conda install babelizer)                         â”‚
â”‚   â˜ Write babel.toml for WRF-Hydro                                      â”‚
â”‚   â˜ Run: babelize init babel.toml â†’ pymt_wrfhydro package              â”‚
â”‚   â˜ Build: pip install -e . (in pymt_wrfhydro directory)                â”‚
â”‚   â˜ Test: python -c "from pymt_wrfhydro import WrfHydro"               â”‚
â”‚   â˜ Write babel.toml for SCHISM                                         â”‚
â”‚   â˜ Run: babelize init babel.toml â†’ pymt_schism package                â”‚
â”‚   â˜ Build & test pymt_schism                                            â”‚
â”‚                                                                          â”‚
â”‚                                                                          â”‚
â”‚   PHASE 3: ğŸ§° REGISTER PyMT PLUGINS                                     â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                    â”‚
â”‚   Status: âŒ WAITING (needs Phase 2)                                    â”‚
â”‚   Difficulty: â­ (registration only)                                    â”‚
â”‚                                                                          â”‚
â”‚   Tasks:                                                                 â”‚
â”‚   â˜ Install PyMT framework (conda install pymt)                         â”‚
â”‚   â˜ Install both plugins into PyMT                                       â”‚
â”‚   â˜ Verify: import pymt; print(pymt.MODELS) â†’ should include both      â”‚
â”‚   â˜ Run bmi-tester on both plugins                                       â”‚
â”‚   â˜ Run each model standalone through PyMT                               â”‚
â”‚   â˜ Validate results match standalone runs                               â”‚
â”‚                                                                          â”‚
â”‚                                                                          â”‚
â”‚   PHASE 4: ğŸŒŠ COUPLE & RUN                                              â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
â”‚   Status: âŒ WAITING (needs Phase 3)                                    â”‚
â”‚   Difficulty: â­â­â­ (scientific coupling challenges)                   â”‚
â”‚                                                                          â”‚
â”‚   Tasks:                                                                 â”‚
â”‚   â˜ Write coupling script (get_value â†’ set_value loop)                  â”‚
â”‚   â˜ Configure grid mapping (1km regular â†’ unstructured triangles)       â”‚
â”‚   â˜ Configure time synchronization (hourly sync points)                 â”‚
â”‚   â˜ Test with a simple coastal domain                                    â”‚
â”‚   â˜ Validate compound flooding results                                   â”‚
â”‚   â˜ Run Hurricane Harvey case study (or similar)                        â”‚
â”‚   â˜ Compare coupled vs uncoupled results                                â”‚
â”‚   â˜ Publish / present results                                           â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£5ï¸âƒ£ The Complete Flow â€” Everything Connected

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   THE COMPLETE PIPELINE: From Raw Fortran to Python Coupling            â”‚
â”‚                                                                          â”‚
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚   â”‚  WRF-Hydro  â”‚    â”‚   SCHISM    â”‚    Layer 1: Original Models        â”‚
â”‚   â”‚  (Fortran)  â”‚    â”‚  (Fortran)  â”‚    (already exist)                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚          â”‚                  â”‚                                            â”‚
â”‚          â–¼                  â–¼                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚   â”‚bmi_wrf_hydroâ”‚    â”‚ bmischism   â”‚    Layer 2: BMI Wrappers           â”‚
â”‚   â”‚   .f90      â”‚    â”‚   .f90      â”‚    + Standard Names mapping        â”‚
â”‚   â”‚ (WRITE NEW) â”‚    â”‚ (EXISTS âœ…) â”‚    (41 functions each)             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚          â”‚                  â”‚                                            â”‚
â”‚          â–¼                  â–¼                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚   â”‚  Babelizer  â”‚    â”‚  Babelizer  â”‚    Layer 3: Babelize               â”‚
â”‚   â”‚  (run once) â”‚    â”‚  (run once) â”‚    (Fortran â†’ Python)              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚          â”‚                  â”‚                                            â”‚
â”‚          â–¼                  â–¼                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚   â”‚pymt_wrfhydroâ”‚    â”‚ pymt_schism â”‚    Layer 3 Output:                 â”‚
â”‚   â”‚  (Python    â”‚    â”‚  (Python    â”‚    pip-installable packages         â”‚
â”‚   â”‚   package)  â”‚    â”‚   package)  â”‚                                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚          â”‚                  â”‚                                            â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                   â”‚                                                      â”‚
â”‚                   â–¼                                                      â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚          â”‚    PyMT         â”‚         Layer 4: Coupling Framework         â”‚
â”‚          â”‚   Framework     â”‚         (grid mappers, time steppers,       â”‚
â”‚          â”‚                 â”‚          data exchange, NetCDF output)      â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                   â”‚                                                      â”‚
â”‚                   â–¼                                                      â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚          â”‚   Jupyter       â”‚         Layer 5: Scientist                  â”‚
â”‚          â”‚   Notebook      â”‚         (~20 lines of Python)              â”‚
â”‚          â”‚                 â”‚         Compound flooding simulation!       â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£6ï¸âƒ£ Quick Reference: All Official Links

### ğŸ”— Everything You Need, Organized

| Tool | Official Docs | GitHub | Install |
|------|-------------|--------|---------|
| ğŸ”Œ **BMI** | https://bmi.csdms.io | https://github.com/csdms/bmi | (specification only) |
| ğŸ”Œ **BMI Fortran** | (in GitHub README) | https://github.com/csdms/bmi-fortran | `conda install bmi-fortran` |
| ğŸ”Œ **BMI Example Fortran** | (in GitHub README) | https://github.com/csdms/bmi-example-fortran | (build from source) |
| ğŸ“› **Standard Names** | https://standard-names.readthedocs.io | https://github.com/csdms/standard_names_registry | `pip install standard_names` |
| ğŸ”® **Babelizer** | https://babelizer.readthedocs.io | https://github.com/csdms/babelizer | `conda install babelizer` |
| ğŸ§° **PyMT** | https://pymt.readthedocs.io | https://github.com/csdms/pymt | `conda install pymt` |
| ğŸŒŠ **SCHISM BMI** | (in GitHub repo) | https://github.com/schism-dev/schism_NWM_BMI | (build from source) |
| ğŸ§ª **BMI Tester** | (in GitHub README) | https://github.com/csdms/bmi-tester | `conda install bmi-tester` |
| ğŸ§° **CSDMS Workbench** | https://csdms.colorado.edu/wiki/Workbench | (multiple repos) | (see individual tools) |
| ğŸ’¬ **CSDMS Help Desk** | (support portal) | https://github.com/csdms/help-desk | (submit issues) |

---

## 1ï¸âƒ£7ï¸âƒ£ The One-Page Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸ¯ GOAL: Couple WRF-Hydro + SCHISM for compound flooding             â”‚
â”‚                                                                          â”‚
â”‚   ğŸ”Œ BMI: The 41-function interface that makes models controllable      â”‚
â”‚          SCHISM has it âœ…  |  WRF-Hydro needs it âŒ (our main task)    â”‚
â”‚                                                                          â”‚
â”‚   ğŸ“› STANDARD NAMES: Universal variable naming (object__quantity)       â”‚
â”‚          So "QLINK1" and "discharge" both become                        â”‚
â”‚          "channel_water__volume_flow_rate"                               â”‚
â”‚                                                                          â”‚
â”‚   ğŸ”® BABELIZER: Converts Fortran BMI â†’ Python package (used TWICE)     â”‚
â”‚          Once for WRF-Hydro â†’ pymt_wrfhydro                            â”‚
â”‚          Once for SCHISM â†’ pymt_schism                                  â”‚
â”‚                                                                          â”‚
â”‚   ğŸ§° PyMT: The ONE framework that runs and couples BOTH plugins        â”‚
â”‚          Handles grid mapping, time sync, data exchange                  â”‚
â”‚          Result: ~20 lines of Python for compound flooding!             â”‚
â”‚                                                                          â”‚
â”‚   â­ HARDEST PART: Writing bmi_wrf_hydro.f90 (Phase 1)                 â”‚
â”‚   ğŸ¤– EASIEST PART: Babelizing (Phase 2, mostly automated)              â”‚
â”‚   ğŸ‰ MOST EXCITING: Running coupled simulations (Phase 4)              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*Document based exclusively on official CSDMS documentation, GitHub repositories, ReadTheDocs pages, and published references (Hutton et al. 2020, Peckham 2014).*

*Prepared for the WRF-Hydro / SCHISM BMI coupling project.*
